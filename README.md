# MiniVSFS: A Simple File System Implementation in C

This project is an implementation of MiniVSFS, a small, inode-based file system inspired by the VSFS (Very Simple File System). The implementation consists of two main C programs:

1.  [cite_start]**`mkfs_builder`**: A tool that creates a fresh, empty MiniVSFS disk image from scratch. [cite: 3]
2.  [cite_start]**`mkfs_adder`**: A tool that adds a file from the host system into the root directory of an existing MiniVSFS disk image. [cite: 5, 6]

## Key Features

- [cite_start]**Block-Based Structure:** The file system is organized into a standard layout containing a superblock, inode bitmap, data bitmap, inode table, and data blocks. [cite: 10, 51, 52, 53, 54, 55]
- [cite_start]**Root Directory Only:** To maintain simplicity, the file system supports only a single root directory (`/`). [cite: 13]
- [cite_start]**Direct Pointers:** Each inode uses 12 direct pointers to locate its data blocks. [cite: 65] [cite_start]Indirect pointers are not implemented. [cite: 13]
- [cite_start]**Data Integrity:** Metadata structures (superblock, inodes, and directory entries) are protected by checksums (CRC32 and XOR) to verify their integrity. [cite: 96, 97]

## Project Structure

- [cite_start]`mkfs_builder.c`: Source code for the file system image creator. [cite: 123]
- [cite_start]`mkfs_adder.c`: Source code for the file adder utility. [cite: 124]
- `validator.c`: An instructor-provided utility to check the integrity and correctness of the generated disk images.
- [cite_start]`file_*.txt`: Sample text files used for testing the `mkfs_adder` program. [cite: 125]

---

## Getting Started

Follow these steps to compile and run the project on a Linux-based system like Ubuntu.

### Prerequisites

A C compiler such as **GCC** is required to compile the source code.

### 1. Compilation

Open your terminal in the project directory and run the following commands to compile the two main programs and the validator:

```bash
# Compile the builder
gcc -O2 -std=c17 -Wall -Wextra mkfs_builder.c -o mkfs_builder

# Compile the adder
gcc -O2 -std=c17 -Wall -Wextra mkfs_adder.c -o mkfs_adder

# Compile the validator
gcc -O2 -std=c17 -Wall -Wextra validator.c -o validator
```

### 2. Execution Workflow

The programs must be run in a specific order.

#### **Step A: Create the Disk Image**

[cite_start]First, use `mkfs_builder` to create an empty disk image. [cite: 33]

```bash
./mkfs_builder --image out.img --size-kib 512 --inodes 512
```

#### **Step B: Add a File to the Image**

Next, use `mkfs_adder` to add a file (e.g., `file_19.txt`) to the image you just created. [cite_start]This will produce a new image file (`out2.img`). [cite: 38]

```bash
./mkfs_adder --input out.img --output out2.img --file file_19.txt
```

---

## How to Manually Check the Output

You can use several command-line tools to inspect and compare the generated image files.

### Checking File Sizes

Use `ls -lh` to get a long, human-readable listing of the files. The total size of `out.img` and `out2.img` should be identical, as `mkfs_adder` modifies the image in-place without changing its overall size.

```bash
ls -lh out.img out2.img
```

### Inspecting Binary Content

To see the raw bytes of the file system, you should use a hex editor. [cite_start]The project specification recommends `hexdump` or `xxd` for debugging. [cite: 120]

#### **View a Single Image**

To view the contents of a single file, use `hexdump -C`. This is useful for seeing the superblock data at the beginning or finding the text of a file you added.

```bash
hexdump -C out2.img | less
```

#### **Compare Both Images**

The best way to see exactly what `mkfs_adder` changed is to perform a visual "diff" on the hex output of both files. This will highlight the changed bytes in the bitmaps, inode table, and data blocks side-by-side.

```bash
diff -y <(xxd out.img) <(xxd out2.img) | less
```

---

## How to Validate Your Image

Use the compiled `validator` program to check the integrity of the images generated by your programs.

#### **Run on the Builder's Output**

This checks the structure of the initial, empty file system.

```bash
./validator out.img
```

#### **Run on the Adder's Output**

This checks the file system after a file has been added.

```bash
./validator out2.img
```

A successful validation will typically print a confirmation message. If there are errors in the file system's structure, the validator will report them.

---
